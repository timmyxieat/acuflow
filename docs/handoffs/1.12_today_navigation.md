# 1.12 Today Screen & Navigation Redesign

## Session Summary

Major UX redesign of the Today screen layout and navigation flow. Converted sidebar to icon rail, repositioned PatientCards as secondary navigation, and implemented direct navigation from Today screen to appointment details with persistent PatientCards sidebar.

## What Was Built/Changed

### 1. Icon Rail Sidebar
- Converted full sidebar (`w-52`) to compact icon rail (`w-12` / 48px)
- Icons only with tooltips on hover (using shadcn Tooltip)
- Logo, nav items (Today, Calendar, Settings), and user avatar
- Active state with accent background

### 2. PatientCards Redesign
- Moved from right side to left side of Timeline
- Removed chief complaint from cards (moved to Timeline)
- Time display below patient name with status-specific formats:
  - In Progress with needles: Timer countdown (`â±ï¸ MM:SS`) or bell when done (`ðŸ”” Timer is up`)
  - All other statuses: Start time
- Bell shake animation every 30 seconds when timer is up
- Seamless card design: no default background, inset box-shadow border on hover/selection
- Hidden scrollbar (touch-friendly for iPad)
- Compact mode for appointment detail page (avatar + time only, format `10:30A`)

### 3. Timeline Updates
- Hour labels column: auto-width with 8px padding (was fixed 64px)
- Added chief complaint below patient name
- Increased `MIN_HOUR_HEIGHT` to 150px (was 120px)
- Scrollbar appears on scroll, fades after 1.5s of inactivity

### 4. Navigation Flow
- Single click on PatientCards/Timeline navigates directly to appointment
- Back button always goes to Today (`/`) not browser history
- PatientCards persists on appointment detail page in compact mode
- Clicking different patient in appointment view navigates to that appointment

### 5. Layout Changes
- PatientCards width: `calc(20vw - 48px)`, min 180px, max 240px
- Topbar height matches sidebar header (`h-14`)
- Both use `bg-sidebar` background
- Removed AppointmentPreview panel (was bottom-right split)

## Key Files Modified

| File | Changes |
|------|---------|
| `src/components/custom/Sidebar.tsx` | Converted to 48px icon rail with tooltips |
| `src/components/custom/TodayScreen.tsx` | Repositioned layout, single-click navigation |
| `src/components/custom/PatientCards.tsx` | New card design, compact mode, time formats |
| `src/components/custom/Timeline.tsx` | Added CC, auto-width hours, MIN_HOUR_HEIGHT |
| `src/components/custom/Topbar.tsx` | Height/bg match sidebar, back to Today |
| `src/components/custom/ScrollableArea.tsx` | Auto-hide scrollbar on scroll |
| `src/app/appointments/[id]/page.tsx` | Added compact PatientCards sidebar |
| `src/app/globals.css` | Bell shake animation, scrollbar-auto, scrollbar-none |
| `src/components/ui/tooltip.tsx` | Added shadcn tooltip component |

## Current State

**Working:**
- Icon rail with tooltips
- PatientCards with new seamless design
- Timer countdown and bell animation
- Single-click navigation to appointments
- Compact PatientCards on appointment page
- Auto-hiding scrollbar on Timeline
- Back to Today navigation

**Layout (Today screen):**
```
â”Œâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ðŸ â”‚ In Progress â”‚ 8 AM                                â”‚
â”‚ðŸ“…â”‚  DK 10:30A  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚âš™ï¸â”‚  EJ â±ï¸3:45  â”‚ 9 AM â”‚ Robert Martinez â€¢ 53 â™‚  â”‚   â”‚
â”‚  â”‚  MG 11:30A  â”‚      â”‚ Knee pain (right)       â”‚   â”‚
â”‚â”€â”€â”‚             â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚SCâ”‚ Checked In  â”‚ 10 AM                              â”‚
â””â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
48px  ~200px                Timeline
```

**Layout (Appointment page):**
```
â”Œâ”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ðŸ â”‚ DK â”‚ Patient Info  â”‚ Appointment Details          â”‚
â”‚ðŸ“…â”‚10A â”‚ Maria Garcia  â”‚ SOAP Sections                â”‚
â”‚âš™ï¸â”‚ EJ â”‚               â”‚                              â”‚
â”‚  â”‚â±ï¸  â”‚ Visit History â”‚                              â”‚
â”‚â”€â”€â”‚ MGâ†â”‚               â”‚                              â”‚
â”‚SCâ”‚11A â”‚               â”‚                              â”‚
â””â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     64px    300px              flex-1
```

## Pending Work

1. **Timer overflow text**: "Timer is up" may be too wide for compact mode - consider shorter text or icon-only
2. **Hover states in compact mode**: May need refinement for touch targets
3. **Appointment detail page width**: Middle panel (300px) may need adjustment based on content

## Technical Notes

### Compact Time Format
```typescript
// Format: "10:30A" or "2:45P"
function formatCompactTime(date: Date): string {
  const hours = date.getHours();
  const minutes = date.getMinutes();
  const hour12 = hours % 12 || 12;
  const ampm = hours >= 12 ? "P" : "A";
  return `${hour12}:${minutes.toString().padStart(2, "0")}${ampm}`;
}
```

### Scrollbar Auto-Hide
- `scrollbar-auto` class with `.is-scrolling` state
- JavaScript adds class on scroll, removes after 1.5s timeout
- CSS transition for smooth fade

### PatientCards Props
```typescript
interface PatientCardsProps {
  onAppointmentClick?: (appointment) => void;
  onAppointmentHover?: (appointmentId: string | null) => void;
  hoveredAppointmentId?: string | null;
  selectedAppointmentId?: string;
  compact?: boolean; // New: shows only avatar + time
}
```

## Known Issues

None currently.

## Files Created This Session

- `docs/handoffs/1.12_today_navigation.md` (this file)
- `src/components/ui/tooltip.tsx` (shadcn component)
