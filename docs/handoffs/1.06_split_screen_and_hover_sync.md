# 1.06 Split Screen and Hover Sync

**Date:** December 11, 2024
**Phase:** 1 - Foundation
**Focus:** Split screen layout, synchronized hover, scroll indicators, off-screen appointment indicators

---

## What Was Built

### Split Screen Layout

When an appointment is selected, the right panel now splits vertically 50/50:
- **Top half**: PatientCards (scrollable status cards)
- **Bottom half**: AppointmentPreview (selected appointment details)

Previously, selecting an appointment replaced the entire right panel with the preview.

### Synchronized Hover Effects

Hovering on an appointment card highlights it in both Timeline and PatientCards simultaneously:
- Timeline card → PatientCard highlights (and vice versa)
- Hover uses status color at ~18% opacity (10% for non-completed, 20% for completed)
- Selected state uses ~30% opacity (50% for completed)

State flow:
```
TodayScreen manages hoveredAppointmentId state
    ↓
Timeline: onAppointmentHover → setHoveredAppointmentId
PatientCards: onAppointmentHover → setHoveredAppointmentId
    ↓
Both receive hoveredAppointmentId and highlight matching cards
```

### ScrollableArea Component

Created reusable `ScrollableArea` component for scroll fade indicators:

```tsx
import { ScrollableArea } from '@/components/custom'

<ScrollableArea className="p-4 space-y-3" deps={[someData]}>
  {/* content */}
</ScrollableArea>
```

Features:
- Top gradient fade when scrolled down
- Bottom gradient fade when more content below
- Auto re-check on resize and when deps change
- Uses `from-gray-400/15` gradient

### Off-Screen Appointment Indicator

When a hovered/selected appointment is scrolled out of view in Timeline, a mini appointment card appears:
- Positioned at top or bottom edge depending on scroll direction
- Horizontally centered with the appointment's column position
- Shows patient name + chevron arrow
- Uses same background/border styling as appointment cards
- Clickable - scrolls Timeline to bring appointment into view
- Works for both hovered and selected appointments

### Timeline Improvements

Added collapsible timeline in AppointmentPreview:
- Shows only the latest relevant timestamp by default
- "See all" / "See less" toggle to expand/collapse
- Entries: Checked In, Started, Needles In, Needles Out, Completed

### Hydration Fix

Created `formatTime()` utility to avoid hydration mismatches from `toLocaleTimeString()`:
- Manual string formatting ensures server/client produce identical output
- Located in `src/lib/dev-time.ts`

### AppointmentPreview Refinements

- Removed status badge from demographics section
- Removed appointment type icon from header
- Added appointment type (icon + name) in body section
- Reordered: Status → Appointment Type → Age/Gender → CC
- Age and gender now written out (e.g., "42 years old, Female")

### PatientCards Divider

Added horizontal divider between Scheduled and Unsigned/Completed sections:
- Edge-to-edge styling with `-mx-2`
- Only shows when both sections have appointments

---

## Key Files Modified

```
src/components/custom/
├── ScrollableArea.tsx      # NEW - Reusable scroll fade container
├── TodayScreen.tsx         # Split layout, hover state management
├── Timeline.tsx            # Hover sync, off-screen indicator, scroll tracking
├── PatientCards.tsx        # Hover sync, ScrollableArea, divider
├── AppointmentPreview.tsx  # ScrollableArea, timeline collapse, layout changes
├── Topbar.tsx              # formatTime import
└── index.ts                # ScrollableArea export

src/lib/
└── dev-time.ts             # formatTime() utility for hydration-safe time formatting
```

---

## Technical Details

### Hover State Props

Timeline and PatientCards both accept:
```typescript
onAppointmentHover?: (appointmentId: string | null) => void
hoveredAppointmentId?: string | null
```

### Background Color Logic

```typescript
// Selected: 30% (50% for completed)
// Hovered: 18% (33% for completed - using hex)
const getBackgroundColor = () => {
  if (isSelected) {
    return isCompleted ? `${statusColor}50` : `${statusColor}30`
  }
  if (isHovered) {
    return isCompleted ? `${statusColor}33` : `${statusColor}18`
  }
  return '#94a3b820' // default gray
}
```

### Off-Screen Detection

Timeline tracks scroll position and calculates if hovered/selected appointment is above or below viewport:
```typescript
const indicatorOffScreen = useMemo(() => {
  // Calculate appointment position based on scheduled time
  // Compare with current scroll viewport
  // Return 'above' | 'below' | null
}, [indicatorAppointment, hourHeight, scrollPosition])
```

---

## Current State

The Today Screen now features:
- Split screen when appointment selected (PatientCards + Preview)
- Synchronized hover highlighting across Timeline and PatientCards
- Scroll fade indicators on all scrollable areas
- Mini card indicator for off-screen appointments
- Collapsible timeline in appointment details

---

## Pending Work

1. **"Open Full Record" button** - Still not functional
2. **Patient detail view** - No patient profile screen
3. **Visit/SOAP documentation** - No clinical documentation screen
4. **Database integration** - Still using mock data
5. **Cancelled/No-Show section** - Not rendered in PatientCards

---

## Session Summary

This session focused on UX polish for the Today Screen:
1. Implemented split-screen layout for better context when viewing appointment details
2. Added synchronized hover effects between Timeline and PatientCards
3. Created reusable ScrollableArea component with scroll fade indicators
4. Built off-screen appointment indicator (mini card) for Timeline
5. Fixed hydration errors with centralized time formatting
6. Refined AppointmentPreview layout and added collapsible timeline
