# Handoff 1.39: Visit History Slide Animation

## Summary

Added vertical slide animation when navigating between appointments via the Visit History panel. When viewing a signed completed appointment and clicking a past visit, the content now slides up or down based on the chronological direction.

## What Was Built

**Feature**: Vertical slide transition for same-patient appointment navigation

**Animation behavior**:
- Clicking an older appointment (lower in list) → content slides up (new content enters from bottom)
- Clicking a newer appointment (higher in list) → content slides down (new content enters from top)

**What animates**:
- Header center section (date, time range, status badge)
- Header right section (visit count, "Since" date)
- SOAP Editor panel (all four sections)
- Patient Context panel

**What does NOT animate** (stays static for same-patient navigation):
- Header left section (patient avatar, name, demographics)
- Visit History panel (already uses patient-based key)

## Key Files Modified

| File | Changes |
|------|---------|
| `src/app/appointments/[id]/page.tsx` | Updated AppointmentHeader component to handle split animation; updated PatientContext animation key and conditions |

## Implementation Details

### AppointmentHeader Changes

1. Added new props: `slideDirection` and `transitionSource`
2. Split the header into three sections with different animation behaviors:
   - **Left section** (patient info): Static, no animation
   - **Center section** (appointment info): Wrapped in AnimatePresence, keyed by `header-center-${appointment.id}`
   - **Right section** (visit stats): Wrapped in AnimatePresence, keyed by `header-right-${appointment.id}`

### PatientContext Changes

1. Changed key from `context-${middlePanelKey}` to `context-${appointmentId}`
2. Updated animation conditions to match SOAP panel logic (uses `transitionSource === 'scheduled'` directly instead of `shouldAnimateMiddlePanel`)

### Animation Logic

The direction is determined in `handleSelectVisit` (line ~1578):
```typescript
const direction = targetApptDate > currentApptDate ? 'down' : 'up'
```

All animated elements use the same transition timing from `SIDEBAR_ANIMATION.transition` to ensure synchronized movement.

## Current State

- ✅ Build passing
- ✅ Vertical slide animation working for same-patient navigation
- ✅ Patient info section stays static (doesn't animate)
- ✅ All content sections (header, SOAP, PatientContext) animate together

## Testing Notes

**Test scenario**: Robert Martinez (appt_001)
1. Navigate to `/appointments/appt_001` (Dec 16, signed completed)
2. Click "Dec 2" in Visit History → content slides up
3. Click "Dec 16" → content slides down
4. Patient avatar/name stays static during transitions

## Pending Work

None - feature is complete.

## Session Summary

Implemented vertical slide animation for the Visit History navigation feature. The key insight was that the header needed to be split into static (patient info) and animated (appointment info) sections, since same-patient navigation should keep the patient identity stable while animating the appointment-specific content.
