# Handoff 1.37: Visit History Navigation and Preview Behavior

## Summary

Implemented differentiated behavior for the Visit History panel based on appointment status:
- **Signed completed appointments**: Clicking a past visit navigates to that appointment
- **All other appointments** (unsigned, in-progress, scheduled, checked-in): Clicking a past visit selects it for preview with SOAP content shown below textareas

## Key Changes

### Visit History Click Behavior (`src/app/appointments/[id]/page.tsx`)

1. **`handleSelectVisit` function** (line ~1553-1597):
   - For signed completed appointments (`status === 'COMPLETED' && isSigned === true`): Navigates to the clicked appointment
   - For all other appointments: Toggles preview selection (shows/hides SOAP preview)

2. **Preview initialization** (line ~1417-1443):
   - Added `isSignedCompleted` flag to determine behavior
   - Signed completed: No auto-selection, no preview
   - All others: Auto-selects most recent past visit for preview

3. **Past visits rendering** (line ~670-696):
   - Added `isEditing` prop to completed visits section
   - When viewing a past appointment, its card shows blue "editing" indicator
   - Color uses `TIMELINE_COLORS.editing` (blue) when editing, `TIMELINE_COLORS.completed` (slate) otherwise

### Files Modified

| File | Changes |
|------|---------|
| `src/app/appointments/[id]/page.tsx` | Visit history click behavior, preview initialization, editing indicator for past visits |
| `src/components/custom/index.ts` | Removed non-exported `IntakeData` type from exports |

## Behavior Matrix

| Current Appointment Status | Click Past Visit | Auto-Select Preview | Preview Shown |
|---------------------------|------------------|---------------------|---------------|
| Signed Completed | Navigates to that appointment | No | No |
| Unsigned | Toggles preview selection | Yes (most recent) | Yes |
| In Progress | Toggles preview selection | Yes (most recent) | Yes |
| Checked In | Toggles preview selection | Yes (most recent) | Yes |
| Scheduled | Toggles preview selection | Yes (most recent) | Yes |

## Visual Indicators

- **Blue left border + blue background**: Current appointment being viewed/edited
- **Slate left border**: Preview-selected past visit (for non-signed-completed appointments)
- **No indicator**: Unselected past visits

## Current State

- Build passing
- All visit history behaviors working as specified
- Preview auto-selects for unsigned/in-progress appointments
- Navigation works for signed completed appointments

## Testing Notes

Test scenarios:
1. **Unsigned appointment (Sue Brown)**: Should auto-select most recent past visit, show preview under SOAP
2. **Signed completed (Robert Martinez)**: No auto-selection, clicking Dec 2 navigates to that appointment
3. **In Progress (David Kim)**: Should auto-select preview, clicking toggles selection

## Known Issues / Pending Work

None identified for this feature. The visit history panel behavior is complete.

## Session Context

This session focused on implementing the differentiated click behavior based on whether viewing a signed completed appointment vs any other status. The key insight was that "Unsigned" appointments have `status === 'COMPLETED'` but `isSigned === false`, so the condition needed to check both fields.
