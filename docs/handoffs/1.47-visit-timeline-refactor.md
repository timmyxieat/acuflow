# 1.47 Visit Timeline Refactor & Layout Planning

## Session Summary

This session focused on two main areas:
1. **Implemented:** Simplified the Visit Timeline from 5 sections to 2 sections
2. **Planned:** Designed a new appointment detail page layout (documented for future implementation)

---

## What Was Built

### Visit Timeline Refactor

Simplified the Visit History panel from 5 status-based sections to 2 intuitive sections:

**Before (5 sections):**
- Scheduled
- Checked In
- In Progress
- Unsigned
- Completed

**After (2 sections):**
- **Upcoming** - Today's appointments (any status) + future scheduled appointments
- **Past** - Visit history from previous days

**Key changes:**
- Status is now indicated via colored dots on cards rather than separate sections
- Today's appointments sorted by status priority (in_progress > checked_in > scheduled > completed)
- Future appointments show expand/collapse for locked items
- Cleaner visual hierarchy with simple "UPCOMING" and "PAST" labels

### Files Modified

| File | Change |
|------|--------|
| `src/app/appointments/[id]/components/VisitTimeline.tsx` | Complete refactor to 2-section layout |
| `src/contexts/HeaderContext.tsx` | Minor updates |

---

## Layout Redesign (Planned, Not Implemented)

A comprehensive layout redesign was discussed and documented. The developer prompt is included below for future implementation.

### Proposed New Layout

```
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A  â”‚                                                                                            â”‚
â”‚ ğŸ  â”‚  â† Back                    [EJ]â—  Em Johnson                                          ğŸ”   â”‚
â”‚    â”‚                                  40y, F                                                    â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“… â”‚            â”‚             â”‚  Dec 24 Â· in 7d                Medical â”‚ Billing â”‚ Schedule â”‚ Comms
â”‚    â”‚  PATIENT   â”‚  UPCOMING   â”‚  11:00 AM - 12:00 PM                                            â”‚
â”‚ âš™ï¸ â”‚  CARDS     â”‚  â— Dec 17   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    â”‚            â”‚    Dec 24   â”‚                                           â”‚                      â”‚
â”‚    â”‚  â— Emily   â”‚    Dec 31   â”‚                                           â”‚     PATIENT          â”‚
â”‚    â”‚    John    â”‚    Jan 7    â”‚         S O A P   E D I T O R             â”‚     CONTEXT          â”‚
â”‚    â”‚    Sarah   â”‚             â”‚                                           â”‚                      â”‚
â”‚    â”‚    Mike    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         (Medical tab content)             â”‚    Conditions        â”‚
â”‚    â”‚            â”‚  PAST (4)   â”‚                                           â”‚    Meds              â”‚
â”‚    â”‚            â”‚    Dec 10   â”‚                                           â”‚    Allergies         â”‚
â”‚ ğŸ‘¤ â”‚            â”‚    Nov 17   â”‚                                           â”‚    Notes             â”‚
â”‚ NX â”‚            â”‚    Sep 18   â”‚                                           â”‚                 +    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Layout Changes (To Be Implemented)

1. **Topbar** - Patient avatar (with status dot) + name + demographics centered
2. **Status dot on avatar** - Only for today's appointments, uses `getStatusColor()`
3. **Tab bar moves to top** - Date/time left-aligned, tabs right-aligned
4. **Remove Patient Context header** - No more "Visits (X) Since [Date]"

---

## Developer Prompt for Layout Implementation

The full developer prompt is saved in this session's conversation and includes:
- Detailed topbar structure with center-aligned patient info
- Status dot implementation (matching PatientSearchCommand.tsx pattern)
- Tab bar row with date/time (left) and tabs (right)
- Panel layout: Sidebar | PatientCards | VisitHistory | (Tabs + SOAP + PatientContext)
- All alignment specs and visual requirements

---

## Previous Session Changes (Already Committed)

These were implemented in earlier parts of the conversation and committed in previous sessions:

- `getBackButtonLabel()` in date-utils.ts
- Orange accent line in Topbar for non-today dates
- Dynamic back button labels
- PatientCards date prop for appointment detail page
- Removed orange background color changes

---

## Known Issues / Pending Work

1. **Layout redesign not implemented** - The topbar/tab restructuring is planned but not built
2. **Status dot pattern** - Reference `PatientSearchCommand.tsx` lines 459-470 for implementation

---

## Technical Notes

### Status Dot Pattern (for future reference)

```tsx
{/* Avatar with status indicator */}
<div className="relative flex-shrink-0">
  <div className="flex h-8 w-8 items-center justify-center rounded-full bg-muted">
    {initials}
  </div>
  {isToday && statusDotColor && (
    <div
      className="absolute top-[1px] right-[1px] h-2 w-2 rounded-full"
      style={{ backgroundColor: statusDotColor }}
    />
  )}
</div>
```

### Status Colors

Use `getStatusColor()` from `@/lib/constants`:
- Blue (`#3b82f6`) = In Progress
- Green (`#22c55e`) = Checked In
- Amber (`#f59e0b`) = Unsigned
- Slate (`#94a3b8`) = Scheduled, Completed

---

## Files to Reference

- `src/components/custom/PatientSearchCommand.tsx` - Status dot on avatar pattern
- `src/app/appointments/[id]/components/VisitTimeline.tsx` - New 2-section layout
- `src/lib/constants.ts` - `getStatusColor()` function
