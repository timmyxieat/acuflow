# 1.54 Navigation Restructure (Work in Progress)

## Session Summary

Started implementing the navigation restructure designed in session 1.53. This session focused on:
1. Hiding the global Topbar on pages that manage their own headers
2. Creating new header components
3. Simplifying the appointment detail page by removing unused tab content

**Note: This is a partial implementation. The full VisitContext component still needs to be created.**

## What Was Built

### 1. Conditional Topbar Hiding (Phase 4)

Added `hideGlobalTopbar` flag to HeaderContext:

```typescript
// In HeaderContext.tsx
interface HeaderContent {
  // ... existing fields
  hideGlobalTopbar?: boolean
}

// In AppShell.tsx
{!header.hideGlobalTopbar && <Topbar />}
```

Both TodayScreen and Appointment pages now set `hideGlobalTopbar: true`.

### 2. New Header Components

**TimelineHeader** (`src/components/custom/TimelineHeader.tsx`):
- Shows date title (e.g., "Today, Thursday, December 18")
- Search button with ⌘K shortcut
- Used by both TodayScreen and Appointment pages

**PatientNavHeader** (`src/components/custom/PatientNavHeader.tsx`):
- Patient name with prev/next navigation arrows
- Search button
- Created but not yet integrated

### 3. TodayScreen Refactored

- Uses `TimelineHeader` instead of relying on global Topbar
- Hides global topbar via `hideGlobalTopbar: true`
- Uses `isPatientCardsCollapsed` from TransitionContext (shared state)
- Layout restructured with header spanning full width above content

### 4. Appointment Page Simplified

**Removed:**
- Tab state (`activeTab`) and tab content switching
- `BillingTab`, `CommsTab` components and their mock data
- `scheduleData`, `commsData`, `billingData` mock data generation
- URL-based collapse state (`?cards=collapsed`)

**Changed:**
- Uses `TimelineHeader` for header
- Uses `StatusControls` from TopTabBar directly
- Collapse state now managed by TransitionContext (persists across navigation)

### 5. TopTabBar Refactored

- Exports `StatusControls` as a separate component
- Now includes date/time display (relative date like "Today" or "Yesterday")
- Status dropdown + action button in top right
- Simplified tab layout with icons + labels

### 6. PatientCards Updated

New props added:
- `hideHeader?: boolean` - Option to hide the date header
- `selectedPatientId?: string` - Highlight by patient ID (for viewing appointment from different day)

## Key Files Modified

| File | Changes |
|------|---------|
| `src/contexts/HeaderContext.tsx` | Added `hideGlobalTopbar` flag |
| `src/components/custom/AppShell.tsx` | Conditional Topbar rendering |
| `src/components/custom/TimelineHeader.tsx` | **NEW** - Date + search header |
| `src/components/custom/PatientNavHeader.tsx` | **NEW** - Patient nav header (not yet used) |
| `src/components/custom/TodayScreen.tsx` | Uses TimelineHeader, hides global topbar |
| `src/app/appointments/[id]/page.tsx` | Major simplification, removed tabs |
| `src/app/appointments/[id]/components/TopTabBar.tsx` | Added date/time, exports StatusControls |
| `src/app/appointments/[id]/components/index.ts` | Updated exports |
| `src/components/custom/PatientCards.tsx` | Added hideHeader, selectedPatientId props |
| `src/components/custom/index.ts` | Export new components |
| `src/contexts/TransitionContext.tsx` | Minor adjustments |

## Current State

- **Build status**: Has errors - `VisitContext` component is imported but doesn't exist yet
- Today screen works with new layout
- Appointment page partially restructured but incomplete

## Pending Work

### High Priority (to fix build)

1. **Create VisitContext component** (`src/app/appointments/[id]/components/VisitContext.tsx`):
   - Patient avatar + name
   - Appointment date/time
   - Status controls (dropdown + action button)
   - Should replace patient info currently in Visit History header

### From Original 1.54 Spec

2. **Update appointment page layout** (Phase 3):
   - VisitContext + TopTabBar should form header row
   - Current TopTabBar has the status controls, need to move to VisitContext

3. **Re-add tab functionality** if needed:
   - Removed BillingTab, CommsTab - may need to bring back
   - Or decide if medical-only view is the intended design

4. **Back navigation** (Phase 5):
   - Currently relies on sidebar logo click
   - May want back arrow in VisitContext or PatientNavHeader

5. **PatientNavHeader integration**:
   - Created but not used
   - Could replace current TopTabBar approach

## Design Decisions Made

1. **Shared collapse state**: PatientCards collapse state now in TransitionContext, not URL params
2. **TimelineHeader**: Simple component showing date + search, reused across pages
3. **StatusControls exported separately**: Can be used by future VisitContext component

## Architecture Notes

The navigation restructure is moving toward:
```
┌────────┬────────────────┬────────────────────────────────────────────┐
│        │                │  TimelineHeader (full width)               │
│Sidebar │  PatientCards  │  Date display + Search                     │
│        │                ├────────────────────────────────────────────│
│        │                │  Content area                              │
└────────┴────────────────┴────────────────────────────────────────────┘
```

Instead of having a global Topbar that changes behavior per page, each page now manages its own header.
