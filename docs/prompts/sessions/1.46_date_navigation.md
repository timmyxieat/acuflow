# Session 1.46: Date Navigation for Today Screen

## Context

Read these files first:

1. `.claude.md` - Project conventions
2. `docs/handoffs/1.44-adaptive-patient-context.md` - Latest handoff
3. `prisma/schema.prisma` - Data model

## Overview

Add date navigation to the Today screen header, allowing practitioners to view appointments from other days. The header should show navigation arrows to move between days/weeks, with contextual labels and a "Back to Today" button when viewing other dates.

## Requirements

### Header Layout

The header should have this structure (left to right):

1. **Back to Today button** (far left) - Only visible when NOT viewing today
2. **Search button** - Stays in its current position
3. **Navigation controls** (center) - Week arrows, day arrows, date title
4. **Date subtitle** - Below the title, contextual based on which day

### Navigation Controls (Centered)

Five elements in a row:

- **‹‹** (double chevron left) - Jump back 1 week
- **‹** (single chevron left) - Previous day
- **Title** - "Today" or the date (e.g., "December 18")
- **›** (single chevron right) - Next day
- **››** (double chevron right) - Jump forward 1 week

Use Lucide icons: `ChevronLeft`, `ChevronRight`, `ChevronsLeft`, `ChevronsRight`

Arrow buttons should use an accent color (coral/orange - suggest `text-orange-500` or similar).

### Title Logic

| Viewing       | Title                       |
| ------------- | --------------------------- |
| Today         | "Today"                     |
| Any other day | "December 18" (month + day) |

### Subtitle Logic (Contextual Labels)

| Viewing               | Subtitle                             |
| --------------------- | ------------------------------------ |
| Today                 | "Wednesday, December 17" (full date) |
| Tomorrow              | "Tomorrow"                           |
| Yesterday             | "Yesterday"                          |
| This week (not today) | "Thursday" (just day name)           |
| Last week             | "Last Week · Tuesday"               |
| Next week             | "Next Week · Tuesday"               |
| 2+ weeks ago          | "3 weeks ago · Thursday"            |
| 2+ weeks ahead        | "In 2 weeks · Thursday"             |

### Back to Today Button

- Only appears when viewing a day other than today
- Positioned on the far left of the header
- Text: "← Back to Today"
- Styled in accent color (coral/orange) to stand out
- Clicking returns to today's date

### State Management

The selected date needs to be tracked. Options:

1. **URL parameter** (recommended): `/?date=2024-12-18` - allows bookmarking, sharing
2. **Context state**: Add to existing TransitionContext or create DateContext

When date changes:

- PatientCards should update to show that day's appointments
- Timeline should update to show that day's schedule
- Use existing `getAppointmentsForDate(date)` helper

### PatientCards Integration

PatientCards currently shows today's appointments via `getEnrichedAppointments()`.

Modify to accept an optional `date` prop or read from URL/context to filter appointments for the selected date.

**Where to look:**

- `src/components/custom/PatientCards.tsx` - needs to accept date param
- `src/components/custom/TodayScreen.tsx` - orchestrates PatientCards and Timeline
- `src/data/mock/helpers.ts` - has `getAppointmentsForDate(date)` helper

### Timeline Integration

The Timeline component should also update to show the selected date's appointments.

**Where to look:**

- `src/components/custom/Timeline.tsx` - may need date prop

## Key Files to Modify

| File                                       | Changes                                          |
| ------------------------------------------ | ------------------------------------------------ |
| `src/components/custom/Topbar.tsx`       | Add nav arrows, date title, Back to Today button |
| `src/components/custom/TodayScreen.tsx`  | Read date from URL, pass to children             |
| `src/components/custom/PatientCards.tsx` | Accept date prop, filter appointments            |
| `src/components/custom/Timeline.tsx`     | Accept date prop if needed                       |
| `src/data/mock/helpers.ts`               | May need new helper for date label logic         |

## Files to Potentially Create

| File                        | Purpose                                                        |
| --------------------------- | -------------------------------------------------------------- |
| `src/lib/date-helpers.ts` | Helper functions for date labels (getDateLabel, isToday, etc.) |

## Date Label Helper Logic

Create a helper function that takes a date and returns the appropriate label:

```
getDateSubtitle(date: Date): string
- If today → full date string
- If tomorrow → "Tomorrow"
- If yesterday → "Yesterday"
- If same week → day name only
- If last week → "Last Week · {DayName}"
- If next week → "Next Week · {DayName}"
- If older → "{N} weeks ago · {DayName}"
- If future → "In {N} weeks · {DayName}"
```

## URL Structure

- `/` or `/?date=today` → Today's appointments
- `/?date=2024-12-18` → December 18th appointments
- `/appointments/123?from=2024-12-18` → Appointment detail, back returns to Dec 18

The `from` parameter on appointment pages tells the back button where to return.

## Navigation from Appointment Detail

When viewing an appointment from a non-today date:

- "Back" button should return to that date's view, not today
- Pass the viewing date via URL parameter when navigating to appointment

**Where to look:**

- `src/app/appointments/[id]/page.tsx` - reads URL params, handles back navigation
- `src/components/custom/Topbar.tsx` - renders back button

## Styling Guidelines

- Navigation arrows: Use accent color (`text-orange-500` or define in theme)
- Arrow button size: 44px minimum touch target
- Back to Today: Same accent color, clear visual weight
- Keep existing header height (h-14)
- Arrows should have hover states

## Testing Checklist

- [ ] Today shows "Today" title with full date subtitle
- [ ] Single arrow advances/retreats by 1 day
- [ ] Double arrow jumps by 1 week
- [ ] PatientCards updates when date changes
- [ ] Timeline updates when date changes
- [ ] "Back to Today" appears when not on today
- [ ] "Back to Today" returns to today's view
- [ ] Subtitle shows correct contextual label for each scenario
- [ ] URL updates when date changes
- [ ] Refreshing page preserves selected date
- [ ] Navigating to appointment from non-today date preserves return context
- [ ] Back button from appointment returns to correct date

## Success Criteria

The feature is complete when a practitioner can:

1. Use arrows to navigate between days and weeks
2. See contextual labels telling them w
3. hich day they're viewing
4. Quickly return to today with one tap
5. View any day's appointments in PatientCards and Timeline
6. Navigate to an appointment and return to the same day's view
